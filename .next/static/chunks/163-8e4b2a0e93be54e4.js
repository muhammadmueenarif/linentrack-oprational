(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[163],{6647:function(){},4837:function(e,t,r){"use strict";r.d(t,{Z:function(){return k}});var s=r(7437),a=r(2265),o=r(1942),i=r(6463),n=r(7138),l=r(2317),d=r(9842);let c={newOrder:"permNewOrder",pickupDeliveries:"permPickupDeliveries",cleaning:"permCleaning",ironingFolding:"permIroningFolding",ready:"permReady",details:"permDetails",machine:"permMachine"};function u(){try{let e=localStorage.getItem("userData");return e?JSON.parse(e):null}catch(e){return null}}async function h(){let e=u();if(!e)return{};if("Admin"===e.roleType)return{__admin:!0};try{let t="userPermissions:".concat(e.id),r=localStorage.getItem(t);if(r)return JSON.parse(r)||{}}catch(e){}try{let t=e.id;if(!t)return{};let r=(0,d.JU)(l.db,"storeStaff",t),s=await (0,d.QT)(r),a=(s.exists()?s.data():{}).permissions||{};{let t="userPermissions:".concat(e.id);localStorage.setItem(t,JSON.stringify(a))}return a}catch(e){return{}}}async function m(e){let t=u();if(!t)return!1;if("Admin"===t.roleType)return!0;let r=await h();return!!r.__admin||!!r[e]}var x=r(6395);let p=(0,a.createContext)(),f=()=>{let e=(0,a.useContext)(p);if(!e)throw Error("useClock must be used within a ClockProvider");return e},g=()=>(0,s.jsxs)("svg",{width:"11.42",height:"10.61",viewBox:"0 0 11.42 10.61",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("path",{d:"M0 5.30542H11.42",stroke:"#1D68F4",strokeWidth:"1.53696"}),(0,s.jsx)("path",{d:"M6.07544 0.694697L10.7932 5.30542L6.07544 9.91614",stroke:"#1D68F4",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"})]}),v={search:()=>(0,s.jsxs)("svg",{className:"w-5 h-5 text-gray-900",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("path",{d:"M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z",stroke:"#2A2E34",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M16.6569 16.6569L20.5 20.5",stroke:"#2A2E34",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"})]}),"file-text":()=>(0,s.jsxs)("svg",{className:"w-5 h-5 text-gray-900",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("path",{d:"M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z",stroke:"#2A2E34",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M14 2V8H20",stroke:"#2A2E34",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"})]}),"bar-chart":()=>(0,s.jsxs)("svg",{className:"w-5 h-5 text-gray-900",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("path",{d:"M12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3C7.02944 3 3 7.02944 3 12C3 16.9706 7.02944 21 12 21Z",stroke:"#2A2E34",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M12 3V12H21",stroke:"#2A2E34",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"})]}),box:()=>(0,s.jsxs)("svg",{className:"w-5 h-5 text-gray-900",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("path",{d:"M12 4L20 8L12 12L4 8L12 4Z",stroke:"#2A2E34",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M14 6L18 8",stroke:"#2A2E34",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M10 6L6 8",stroke:"#2A2E34",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M4 8L4 16",stroke:"#2A2E34",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M20 8L20 16",stroke:"#2A2E34",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M4 16L12 20L20 16",stroke:"#2A2E34",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M12 12V20",stroke:"#2A2E34",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"})]}),"hard-drive":()=>(0,s.jsxs)("svg",{className:"w-5 h-5 text-gray-900",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("rect",{x:"3",y:"10",width:"18",height:"8",rx:"2",stroke:"#2A2E34",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M5 18H19V22H5V18Z",stroke:"#2A2E34",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("rect",{x:"7",y:"6",width:"10",height:"4",rx:"1",stroke:"#2A2E34",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),users:()=>(0,s.jsxs)("svg",{className:"w-5 h-5 text-gray-900",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("path",{d:"M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z",stroke:"#2A2E34",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M19 21V19C19 16.7909 17.2091 15 15 15H9C6.79086 15 5 16.7909 5 19V21",stroke:"#2A2E34",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M16 7C16 4.79086 17.7909 3 20 3C22.2091 3 24 4.79086 24 7",stroke:"#2A2E34",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M19 15C21.2091 15 23 16.7909 23 19V21",stroke:"#2A2E34",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"})]}),"trending-up":()=>(0,s.jsxs)("svg",{className:"w-5 h-5 text-gray-900",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("path",{d:"M12 21.0001C16.9706 21.0001 21 16.9706 21 12.0001C21 7.02951 16.9706 3.00006 12 3.00006C7.02944 3.00006 3 7.02951 3 12.0001C3 16.9706 7.02944 21.0001 12 21.0001Z",stroke:"#2A2E34",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M12 16.5001C14.4853 16.5001 16.5 14.4853 16.5 12.0001C16.5 9.51486 14.4853 7.50006 12 7.50006C9.51472 7.50006 7.5 9.51486 7.5 12.0001C7.5 14.4853 9.51472 16.5001 12 16.5001Z",stroke:"#2A2E34",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M12 12.0001V12.0001",stroke:"#2A2E34",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"})]}),settings:()=>(0,s.jsxs)("svg",{className:"w-5 h-5 text-gray-900",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("path",{d:"M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z",stroke:"#2A2E34",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M19 21V19C19 16.7909 17.2091 15 15 15H9C6.79086 15 5 16.7909 5 19V21",stroke:"#2A2E34",strokeWidth:"1.53696",strokeLinecap:"round",strokeLinejoin:"round"})]})},w=e=>{var t;let{subscriptionData:r}=e,l=(0,i.usePathname)(),d=(null==r?void 0:r.features)?null==r?void 0:r.features:null===(t=JSON.parse(localStorage.getItem("subscriptionData")))||void 0===t?void 0:t.features,u=[{name:"New Order",path:"/Admin",feature:"Order per month",permKey:c.newOrder},...d&&!1===d.pickupDelivery?[]:[{name:"Pickup & Deliveries",path:"/Admin/Delivery",feature:"Pickup & Delivery",permKey:c.pickupDeliveries}],{name:"Cleaning",path:"/Admin/Cleaning",feature:"Order per month",permKey:c.cleaning},{name:"Ironing & Folding",path:"/Admin/Ironing",feature:"Ironing & Folding",permKey:c.ironingFolding},{name:"Ready",path:"/Admin/Ready",feature:"Ready",permKey:c.ready},{name:"Details",path:"/Admin/Detailed",feature:"Details",permKey:c.details},{name:"Machine",path:"/Admin/Machine",feature:"Machine",permKey:c.machine}];return(0,s.jsx)("div",{className:"flex flex-1 justify-center",children:(0,s.jsx)("ul",{className:"flex whitespace-nowrap gap-5",children:u.map(e=>{let[t,r]=a.useState(!0);return a.useEffect(()=>{(async()=>{r(await m(e.permKey))})()},[e.permKey]),(0,s.jsx)("li",{className:"relative",children:t?(0,s.jsx)(n.default,{href:e.path,className:"cursor-pointer hover:text-yellow-500 transition-colors duration-200 ".concat(l===e.path?"text-yellow-500 font-bold":"text-white"," inline-block"),style:{fontFamily:"Poppins, sans-serif",fontWeight:500,fontSize:"14.0625px",lineHeight:"21px"},children:e.name}):(0,s.jsxs)("div",{className:"flex items-center text-gray-400 cursor-not-allowed",children:[e.name,(0,s.jsx)(o.kUi,{className:"ml-1 text-xs"}),(0,s.jsx)("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-800 text-white text-xs rounded opacity-0 hover:opacity-100 transition-opacity whitespace-nowrap",children:"You do not have permission"})]})},e.path)})})})},b=e=>{let{subscriptionData:t}=e,r=(0,i.useRouter)();null==t||t.features;let a=e=>{e.path&&r.push(e.path)};return(0,s.jsx)("div",{className:"grid grid-cols-2 gap-1 p-6",children:[{name:"Search",description:"Find An item",icon:"search",feature:"Order per month",path:"/Admin/NavMenu/Search"},{name:"Hardware",description:"Get invoices",icon:"hard-drive",feature:"Hardware Integration",path:"/Admin/NavMenu/Hardware"},{name:"Invoice",description:"Impactful storytelling",icon:"file-text",feature:"Auto Invoicing",path:"/Admin/NavMenu/Invoice"},{name:"Users",description:"Functional digital products",icon:"users",feature:"Admin Tools",path:"/Admin/NavMenu/Users"},{name:"Metrix",description:"Beautiful crafted prints",icon:"bar-chart",feature:"Order per month",path:"/Admin/NavMenu/Dashboard"},{name:"Marketing",description:"Beautiful crafted prints",icon:"trending-up",feature:"Marketing",path:"/Admin/NavMenu/Marketing"},{name:"Products",description:"Artistic visual expression",icon:"box",feature:"Order per month",path:"/Admin/NavMenu/Products"},{name:"Admin",description:"Artistic visual expression",icon:"settings",feature:"Admin Tools",path:"/Admin/NavMenu/Dashboard"}].map((e,t)=>{let r=v[e.icon];return(0,s.jsxs)("div",{className:"flex items-center p-2 rounded-lg ".concat("hover:bg-gray-50 transition-colors duration-150 cursor-pointer"),onClick:()=>a(e),role:"button",tabIndex:0,"aria-disabled":!1,children:[(0,s.jsx)("div",{className:"flex items-center justify-center mr-3",children:r?(0,s.jsx)(r,{}):null}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),!1]}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:e.description})]}),(0,s.jsx)(g,{})]},t)})})};var k=e=>{let{subscriptionData:t}=e,[r,c]=(0,a.useState)(!1),[u,h]=(0,a.useState)(!1),[m,p]=(0,a.useState)(!1),[g,v]=(0,a.useState)(!1),[k,y]=(0,a.useState)(null),[j,S]=(0,a.useState)(null),[N,C]=(0,a.useState)(0),[I,L]=(0,a.useState)({amount:"",description:"",notes:"",selectedUserId:"",declaredCash:"",cashFromOrders:"",startingCash:""}),F=()=>{L({amount:"",description:"",notes:"",selectedUserId:A.length>0?A[0].id:"",declaredCash:"",cashFromOrders:"",startingCash:""})},[A,O]=(0,a.useState)([]),[M,E]=(0,a.useState)(!1),[D,U]=(0,a.useState)({requireStartingCash:!1,trackDrawerPayouts:!1}),[W,T]=(0,a.useState)(null),[P,H]=(0,a.useState)(""),[J,B]=(0,a.useState)(""),[V,z]=(0,a.useState)(!1),[Z,q]=(0,a.useState)(!1),[K,R]=(0,a.useState)(""),[Q,_]=(0,a.useState)(""),[G,X]=(0,a.useState)(""),[Y,$]=(0,a.useState)("");(0,a.useRef)([]);let ee=(0,i.useRouter)(),et=null;try{et=f()}catch(e){}let er=(0,a.useRef)(null),es=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=JSON.parse(localStorage.getItem("userData")),t=localStorage.getItem("selectedStoreId");e&&y(e),t&&S(t);let r=e=>{er.current&&!er.current.contains(e.target)&&c(!1),es.current&&!es.current.contains(e.target)&&h(!1)};return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r),c(!1),h(!1),p(!1),v(!1)}},[]),(0,a.useEffect)(()=>{if(!j)return;let e=(0,d.hJ)(l.db,"notifications"),t=(0,d.IO)(e,(0,d.ar)("storeId","==",j),(0,d.ar)("status","==",x.i.Pending)),r=(0,d.cf)(t,e=>{C(e.size)},e=>{console.error("Error fetching notification count:",e)});return()=>r()},[j]),(0,a.useEffect)(()=>{if(!j||!(null==k?void 0:k.id))return;let e=new Date().toLocaleDateString("en-GB"),t=(0,d.hJ)(l.db,"staffShifts"),r=(0,d.IO)(t,(0,d.ar)("storeId","==",j),(0,d.ar)("userId","==",k.id),(0,d.ar)("date","==",e),(0,d.Xo)("createdAt","desc"),(0,d.b9)(1)),s=(0,d.cf)(r,e=>{if(e.empty){T(null),H(""),B("");return}let t=e.docs[0],r=t.data();T({id:t.id,...r}),H(r.clockIn||""),B(r.clockOut||"")});return()=>s()},[j,null==k?void 0:k.id]);let ea=e=>new Intl.DateTimeFormat("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}).format(e),eo=e=>e.toLocaleDateString("en-GB"),ei=async()=>{try{if(!j||!(null==k?void 0:k.id))return;if(W&&!W.clockOut){X("You already have an active shift"),setTimeout(()=>X(""),2500);return}let i=new Date,n=i.getHours();if(!K||!K.trim()){let i=6,c=22;try{let n=(0,d.JU)(l.db,"storeSettings",j),u=await (0,d.QT)(n);if(u.exists()){var e,t,r,s,a,o;let n=u.data();i=null!==(a=null==n?void 0:null===(t=n.security)||void 0===t?void 0:null===(e=t.clockInSettings)||void 0===e?void 0:e.shiftStartHour)&&void 0!==a?a:6,c=null!==(o=null==n?void 0:null===(s=n.security)||void 0===s?void 0:null===(r=s.clockInSettings)||void 0===r?void 0:r.shiftEndHour)&&void 0!==o?o:22}}catch(e){console.warn("Could not fetch shift hours settings",e)}if(n<i||n>=c){X("Cannot clock in outside shift hours (".concat(i,":00 - ").concat(c,":00)")),setTimeout(()=>X(""),2500);return}}let c=K&&K.trim()?K.trim():ea(i),u=el(i,K),h={storeId:j,storeName:localStorage.getItem("selectedStore")||"",userId:k.id,name:k.name||k.email||"Staff",date:eo(i),clockIn:c,clockOut:"",clockInISO:u,clockOutISO:"",createdAt:(0,d.Bt)()};await (0,d.ET)((0,d.hJ)(l.db,"staffShifts"),h);try{await (0,d.ET)((0,d.hJ)(l.db,"shifts"),h)}catch(e){console.warn("Failed to save to shifts collection",e)}z(!1),R(""),H(c),console.log("Time In saved:",c),X("Time in Successfully Added"),setTimeout(()=>X(""),2500)}catch(e){console.error("Time In failed",e)}},en=async()=>{try{var e,t,r,s,a,o,i;if(!j||!(null==k?void 0:k.id)||!W||W.clockOut)return;if(!Q||!Q.trim()){let i=6,n=22;try{let c=(0,d.JU)(l.db,"storeSettings",j),u=await (0,d.QT)(c);if(u.exists()){let l=u.data();i=null!==(a=null==l?void 0:null===(t=l.security)||void 0===t?void 0:null===(e=t.clockInSettings)||void 0===e?void 0:e.shiftStartHour)&&void 0!==a?a:6,n=null!==(o=null==l?void 0:null===(s=l.security)||void 0===s?void 0:null===(r=s.clockInSettings)||void 0===r?void 0:r.shiftEndHour)&&void 0!==o?o:22}}catch(e){console.warn("Could not fetch shift hours settings",e)}let c=new Date().getHours();if(c<i||c>=n){X("Cannot clock out outside shift hours (".concat(i,":00 - ").concat(n,":00)")),setTimeout(()=>X(""),2500);return}}let n=new Date,c=Q&&Q.trim()?Q.trim():ea(n),u=el(n,Q),h=W.clockInISO?Math.max(0,(new Date(u)-new Date(W.clockInISO))/36e5):0;try{let e=(0,d.JU)(l.db,"payrollSettings",j),t=await (0,d.QT)(e),r=16;if(t.exists()){let e=t.data();r=null!==(i=null==e?void 0:e.maxHoursPerShift)&&void 0!==i?i:16}let s=r,a=Math.max(0,(Number(r)||0)+(Number(s)||0));a&&h>a&&(h=a)}catch(e){console.warn("Overtime cap read failed",e)}await (0,d.r7)((0,d.JU)(l.db,"staffShifts",W.id),{clockOut:c,clockOutISO:u,hours:h.toFixed(2)});try{let e=(0,d.hJ)(l.db,"shifts"),t=eo(n),r=(0,d.IO)(e,(0,d.ar)("storeId","==",j),(0,d.ar)("userId","==",k.id),(0,d.ar)("date","==",t),(0,d.Xo)("createdAt","desc"),(0,d.b9)(1)),s=await (0,d.PL)(r);if(!s.empty){let e=s.docs[0];await (0,d.r7)(e.ref,{clockOut:c,clockOutISO:u,hours:h.toFixed(2)})}}catch(e){console.warn("Failed to update shifts collection",e)}q(!1),_(""),B(c),console.log("Time Out saved:",c),X("Time out Successfully Added"),setTimeout(()=>X(""),2500)}catch(e){console.error("Time Out failed",e)}},el=(e,t)=>{if(!t)return e.toISOString();try{let r=t.trim().match(/^(\d{1,2}):(\d{2})\s*(AM|PM)$/i);if(!r)return e.toISOString();let s=parseInt(r[1],10),a=parseInt(r[2],10),o=r[3].toUpperCase();"PM"===o&&12!==s&&(s+=12),"AM"===o&&12===s&&(s=0);let i=new Date(e);return i.setHours(s,a,0,0),i.toISOString()}catch(t){return e.toISOString()}};(0,a.useEffect)(()=>{if(!j)return;let e=(0,d.hJ)(l.db,"storeStaff"),t=(0,d.IO)(e,(0,d.ar)("storeId","==",j)),r=(0,d.cf)(t,e=>{let t=e.docs.map(e=>({id:e.id,...e.data()}));O(t),t.length>0&&!I.selectedUserId&&L(e=>({...e,selectedUserId:t[0].id}))},e=>{console.error("Error loading staff users for cash up:",e)});return()=>r()},[j,I.selectedUserId]),(0,a.useEffect)(()=>{(async()=>{try{if(!j)return;let e=(0,d.JU)(l.db,"storeSettings",j),t=await (0,d.QT)(e);if(t.exists()){let e=t.data();U(e.cashUp||{requireStartingCash:!1,trackDrawerPayouts:!1})}}catch(e){console.error("Error loading cash up settings:",e)}})()},[j]);let ed=async()=>{try{if((null==k?void 0:k.roleType)==="Staff"&&W&&!W.clockOut)try{let t=new Date,r=ea(t),s=t.toISOString(),a=W.clockInISO?Math.max(0,(t-new Date(W.clockInISO))/36e5):0;try{let t=(0,d.JU)(l.db,"payrollSettings",j),r=await (0,d.QT)(t),s=16;if(r.exists()){var e;let t=r.data();s=null!==(e=null==t?void 0:t.maxHoursPerShift)&&void 0!==e?e:16}let o=s,i=Math.max(0,(Number(s)||0)+(Number(o)||0));i&&a>i&&(a=i)}catch(e){console.warn("Overtime cap read failed during logout",e)}await (0,d.r7)((0,d.JU)(l.db,"staffShifts",W.id),{clockOut:r,clockOutISO:s,hours:a.toFixed(2)});try{let e=(0,d.hJ)(l.db,"shifts"),o=eo(t),i=(0,d.IO)(e,(0,d.ar)("storeId","==",j),(0,d.ar)("userId","==",k.id),(0,d.ar)("date","==",o),(0,d.Xo)("createdAt","desc"),(0,d.b9)(1)),n=await (0,d.PL)(i);if(!n.empty){let e=n.docs[0];await (0,d.r7)(e.ref,{clockOut:r,clockOutISO:s,hours:a.toFixed(2)})}}catch(e){console.warn("Failed to update shifts collection during logout",e)}console.info("[Logout] Auto time-out completed for staff",{userId:k.id,hoursWorked:a.toFixed(2)})}catch(e){console.warn("[Logout] Auto time-out failed",e)}localStorage.removeItem("userData"),localStorage.removeItem("token"),localStorage.removeItem("selectedStoreId"),localStorage.removeItem("selectedStoredata"),window.location.href="/login"}catch(e){console.error("[Logout] Error during logout process",e),localStorage.removeItem("userData"),localStorage.removeItem("token"),localStorage.removeItem("selectedStoreId"),localStorage.removeItem("selectedStoredata"),window.location.href="/login"}},ec=async()=>{try{if(!j||!(null==k?void 0:k.id))throw Error("Store or user information missing");let e=["amount","selectedUserId","declaredCash"];for(let t of(D.requireStartingCash&&!I.startingCash&&e.push("startingCash"),e))if(!I[t])throw Error("Please fill in all required fields: ".concat(t.replace(/([A-Z])/g," $1").toLowerCase()));let t=A.find(e=>e.id===I.selectedUserId);await (0,d.ET)((0,d.hJ)(l.db,"cashups"),{amount:parseFloat(I.amount),declaredCash:parseFloat(I.declaredCash),cashFromOrders:parseFloat(I.cashFromOrders||0),confirmedCash:parseFloat(I.declaredCash),staff:(null==t?void 0:t.name)||(null==t?void 0:t.email)||"Unknown",startingCash:parseFloat(I.startingCash||0),description:I.description,notes:I.notes,storeId:j,userId:I.selectedUserId,createdBy:k.id,createdAt:(0,d.Bt)(),status:"pending",variance:0,settings:D}),F(),p(!1),alert("Cash up recorded successfully!")}catch(e){console.error("Error saving cash up:",e),alert("Failed to save cash up: "+e.message)}},eu=e=>{let{name:t,value:r}=e.target;L(e=>({...e,[t]:r}))},eh=async()=>{try{if(v(!1),(null==k?void 0:k.roleType)==="Staff"&&W&&!W.clockOut)try{let t=new Date,r=ea(t),s=t.toISOString(),a=W.clockInISO?Math.max(0,(t-new Date(W.clockInISO))/36e5):0;try{let t=(0,d.JU)(l.db,"payrollSettings",j),r=await (0,d.QT)(t),s=16;if(r.exists()){var e;let t=r.data();s=null!==(e=null==t?void 0:t.maxHoursPerShift)&&void 0!==e?e:16}let o=s,i=Math.max(0,(Number(s)||0)+(Number(o)||0));i&&a>i&&(a=i)}catch(e){console.warn("Overtime cap read failed during switch user",e)}await (0,d.r7)((0,d.JU)(l.db,"staffShifts",W.id),{clockOut:r,clockOutISO:s,hours:a.toFixed(2)});try{let e=(0,d.hJ)(l.db,"shifts"),o=eo(t),i=(0,d.IO)(e,(0,d.ar)("storeId","==",j),(0,d.ar)("userId","==",k.id),(0,d.ar)("date","==",o),(0,d.Xo)("createdAt","desc"),(0,d.b9)(1)),n=await (0,d.PL)(i);if(!n.empty){let e=n.docs[0];await (0,d.r7)(e.ref,{clockOut:r,clockOutISO:s,hours:a.toFixed(2)})}}catch(e){console.warn("Failed to update shifts collection during switch user",e)}console.info("[Switch User] Auto time-out completed for staff",{userId:k.id,hoursWorked:a.toFixed(2)})}catch(e){console.warn("[Switch User] Auto time-out failed",e)}setTimeout(()=>{localStorage.removeItem("userData"),localStorage.removeItem("selectedStoreId"),localStorage.removeItem("selectedStoredata"),window.location.href="/Login"},100)}catch(e){console.error("[Switch User] Error during switch user process",e),setTimeout(()=>{localStorage.removeItem("userData"),localStorage.removeItem("selectedStoreId"),localStorage.removeItem("selectedStoredata"),window.location.href="/Login"},100)}};return(0,s.jsxs)("nav",{style:{position:"fixed",top:"0px",left:"0px",right:"0px",width:"100%",zIndex:"50",backgroundColor:"#1D50B6",opacity:"1",margin:0,padding:"8px 16px",boxSizing:"border-box"},className:"flex items-center text-white",children:[G&&(0,s.jsx)("div",{className:"fixed top-[64px] left-1/2 -translate-x-1/2 z-[60]",children:(0,s.jsx)("div",{className:"px-4 py-2 rounded-md bg-green-100 text-green-800 border border-green-200 text-sm shadow-sm",children:G})}),(0,s.jsx)("div",{className:"flex items-center space-x-3 flex-1",style:{marginLeft:"3.06%"},children:(0,s.jsxs)("div",{ref:er,className:"relative flex items-center",children:[(0,s.jsx)("img",{src:"/navbar/humbar.svg",alt:"Menu",className:"cursor-pointer",style:{width:"24px",height:"24px"},onClick:()=>c(!r)}),"/Admin"===(0,i.usePathname)()&&(0,s.jsx)("span",{className:"ml-3 font-bold",style:{fontSize:"18px",lineHeight:"22px"},children:"Admin"}),r&&(0,s.jsxs)("div",{className:"absolute left-0 w-[400px] bg-white rounded-lg shadow-lg overflow-hidden",style:{zIndex:10,top:"40px"},children:[(0,s.jsx)("div",{className:"custom-notch"}),(0,s.jsx)(b,{subscriptionData:t})]})]})}),(0,s.jsx)("div",{className:"flex-1 flex justify-center",children:(0,s.jsx)(w,{subscriptionData:t})}),(0,s.jsxs)("div",{className:"flex items-center space-x-4 flex-1 justify-end",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("img",{src:"/navbar/bell.svg",alt:"Notifications",className:"cursor-pointer",style:{width:"24px",height:"24px"},onClick:()=>ee.push("/Admin/Notifications")}),N>0&&(0,s.jsx)("span",{className:"bg-yellow-500 text-black font-bold px-1 text-xs rounded-full absolute -top-2 -right-2",children:N>9?"9+":N})]}),(0,s.jsx)("div",{className:"relative",children:(0,s.jsx)(n.default,{href:"Admin/Chat",children:(0,s.jsx)("img",{src:"/navbar/chat.svg",alt:"Chat",className:"cursor-pointer hover:opacity-90",style:{width:"24px",height:"24px"}})})}),(0,s.jsxs)("div",{ref:es,className:"relative",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3 cursor-pointer",onClick:()=>h(!u),children:[(0,s.jsx)("div",{className:"h-8 border-l border-white/30"}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("div",{style:{fontFamily:"Poppins, sans-serif",fontWeight:700,fontSize:"18px",lineHeight:"27px",color:"#FFFFFF"},children:(null==k?void 0:k.name)||"Guest"}),(0,s.jsx)("div",{style:{fontFamily:"Poppins, sans-serif",fontWeight:400,fontSize:"12px",lineHeight:"18px",color:"#E1E1E1"},children:(null==k?void 0:k.email)||"@".concat(((null==k?void 0:k.username)||((null==k?void 0:k.email)?k.email.split("@")[0]:"guest")).toLowerCase())})]}),(()=>{try{var e,t,r,a;let o=JSON.parse(localStorage.getItem("selectedStoredata"))||{},i=null==o?void 0:null===(t=o.servicesOffered)||void 0===t?void 0:null===(e=t.logo)||void 0===e?void 0:e.url;if(i&&(null==o?void 0:null===(a=o.servicesOffered)||void 0===a?void 0:null===(r=a.logo)||void 0===r?void 0:r.showOnNav))return(0,s.jsx)("img",{src:i,alt:"profile",className:"w-10 h-10 rounded-full object-contain bg-white"})}catch(e){}return(0,s.jsx)("img",{src:"https://placehold.co/40x40/png",alt:"profile",className:"w-10 h-10 rounded-full"})})(),(0,s.jsx)(o.qL$,{className:"text-white text-sm"})]}),u&&(0,s.jsx)("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl overflow-hidden",style:{zIndex:2,maxWidth:"calc(100vw - 2rem)",minWidth:"280px"},children:(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-gray-800",children:(null==k?void 0:k.name)||"Guest"}),(0,s.jsx)("button",{className:"bg-[#F0F0FF] text-red-600 p-1 px-3 rounded-full text-sm",onClick:()=>v(!0),children:"Switch User"})]}),(null==et?void 0:et.isClockStopped)&&(0,s.jsx)("div",{className:"flex items-center justify-center py-2 bg-red-50 border border-red-200 rounded-lg mb-2",children:(0,s.jsxs)("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"}),(0,s.jsx)("span",{className:"text-xs font-medium",children:"Clock Stopped - Enter PIN to Continue"})]})}),(null==k?void 0:k.roleType)==="Staff"&&(0,s.jsx)("div",{className:"flex items-center justify-center py-2 bg-green-50 border border-green-200 rounded-lg mb-2",children:(0,s.jsxs)("div",{className:"flex items-center gap-2 text-green-600 text-sm",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,s.jsx)("span",{className:"text-xs font-medium",children:"Auto Clock System Active"})]})}),(0,s.jsxs)("div",{className:"flex items-center justify-between py-3 border-t border-b border-gray-100 my-2 overflow-hidden",children:[(0,s.jsx)("div",{className:"text-gray-700 text-sm font-medium flex-shrink-0 pr-3",children:"Time In"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-1 justify-end min-w-0",children:[V?(0,s.jsx)("input",{type:"text",placeholder:"hh:mm AM/PM",className:"w-24 px-2 py-1 border border-gray-300 rounded-lg text-sm text-black placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:K,onChange:e=>R(e.target.value),onKeyDown:e=>{"Enter"===e.key&&ei()},autoFocus:!0}):(0,s.jsx)("div",{className:"text-gray-900 text-sm font-medium text-right whitespace-nowrap",children:P||"--:--"}),(0,s.jsx)("button",{className:"bg-[#F0F0FF] text-blue-600 px-2 py-1 rounded-full text-xs font-medium hover:bg-blue-50 transition-colors whitespace-nowrap",onClick:()=>{V?ei():z(!0)},children:V?"Save":"Add"})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between py-3 border-b border-gray-100 overflow-hidden",children:[(0,s.jsx)("div",{className:"text-gray-700 text-sm font-medium flex-shrink-0 pr-3",children:"Time Out"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-1 justify-end min-w-0",children:[Z?(0,s.jsx)("input",{type:"text",placeholder:"hh:mm AM/PM",className:"w-24 px-2 py-1 border border-gray-300 rounded-lg text-sm text-black placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:Q,onChange:e=>_(e.target.value),onKeyDown:e=>{"Enter"===e.key&&en()},autoFocus:!0}):(0,s.jsx)("div",{className:"text-gray-900 text-sm font-medium text-right whitespace-nowrap",children:J||"--:--"}),(0,s.jsx)("button",{className:"bg-[#F0F0FF] text-blue-600 px-2 py-1 rounded-full text-xs font-medium hover:bg-blue-50 transition-colors whitespace-nowrap",onClick:()=>{Z?en():q(!0)},disabled:!P,children:Z?"Save":"Add"})]})]}),(0,s.jsxs)("div",{className:"flex mt-2",children:[(0,s.jsx)("button",{className:"bg-[#F0F0FF] text-blue-600 w-1/2 ml-3 px-1 py-1 rounded-full mb-2 text-sm",onClick:()=>{F(),p(!0)},children:"Cash Up"}),(0,s.jsx)("button",{className:"bg-[#FFEDEB] text-red-600 w-1/2 ml-3 px-1 py-1 rounded-full mb-2 text-sm",onClick:ed,children:"Logout"})]})]})})]})]}),m&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",style:{zIndex:2},children:(0,s.jsxs)("div",{style:{width:"400px"},className:"relative bg-white p-6 rounded-lg ",children:[(0,s.jsx)("div",{className:"absolute right-4 top-4",children:(0,s.jsxs)("svg",{onClick:()=>p(!1),width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("path",{d:"M18 6L6 18",stroke:"#2A2E34",strokeWidth:"2",strokeLinecap:"round"}),(0,s.jsx)("path",{d:"M6 6L18 18",stroke:"#2A2E34",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,s.jsx)("h2",{className:"text-3xl flex justify-center font-semibold mb-4 text-gray-800",children:"Cash Up"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{htmlFor:"startingCash",className:"block text-sm font-medium text-gray-700 mb-2",children:["Starting Cash ",D.requireStartingCash&&(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{id:"startingCash",type:"number",name:"startingCash",placeholder:"Starting Cash",className:"w-full p-2 border rounded text-black placeholder-gray-400",value:I.startingCash,onChange:eu,required:D.requireStartingCash})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"cashFromOrders",className:"block text-sm font-medium text-gray-700 mb-2",children:"Cash From Orders"}),(0,s.jsx)("input",{id:"cashFromOrders",type:"number",name:"cashFromOrders",placeholder:"Cash From Orders",className:"w-full p-2 border rounded text-black placeholder-gray-400",value:I.cashFromOrders,onChange:eu})]})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"declaredCash",className:"block text-sm font-medium text-gray-700 mb-2",children:"Declared Cash *"}),(0,s.jsx)("input",{id:"declaredCash",type:"number",name:"declaredCash",placeholder:"Declared Cash",className:"w-full p-2 border rounded text-black placeholder-gray-400",value:I.declaredCash,onChange:eu,required:!0})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount *"}),(0,s.jsx)("input",{id:"amount",type:"number",name:"amount",placeholder:"Amount",className:"w-full p-2 border rounded text-black placeholder-gray-400",value:I.amount,onChange:eu,required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"selectedUserId",className:"block text-sm font-medium text-gray-700 mb-2",children:"Select User *"}),(0,s.jsxs)("select",{id:"selectedUserId",name:"selectedUserId",className:"w-full p-2 border rounded bg-white text-black focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:I.selectedUserId,onChange:eu,required:!0,children:[(0,s.jsx)("option",{value:"",children:"Select User"}),A.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name||e.email||"Staff ".concat(e.id.slice(-4))},e.id))]})]})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),(0,s.jsx)("textarea",{id:"notes",name:"notes",placeholder:"Notes",className:"w-full p-2 border rounded text-black placeholder-gray-400",rows:"3",value:I.notes,onChange:eu})]}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)("button",{className:"bg-[#1D4FB6] text-white px-4 py-2 rounded disabled:bg-gray-400 disabled:cursor-not-allowed",onClick:ec,disabled:!I.amount||!I.selectedUserId||!I.declaredCash||D.requireStartingCash&&!I.startingCash,children:"Submit"})})]})}),g&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",style:{zIndex:2},children:(0,s.jsxs)("div",{className:"relative bg-white p-6 rounded-2xl shadow-lg mx-4",style:{width:"450px",height:"320px"},children:[(0,s.jsx)("button",{onClick:()=>v(!1),className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-2xl font-bold",children:"\xd7"}),(0,s.jsx)("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-32 h-32 rounded-full bg-[#1D4FB6] flex items-center justify-center",children:(0,s.jsxs)("svg",{style:{transform:"scale(0.8)"},width:"78",height:"78",viewBox:"0 0 78 78",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("path",{d:"M65 68.25V61.75C65 58.9231 62.5766 56.25 59.5 56.25H19.5C16.4234 56.25 14 58.9231 14 61.75V68.25",stroke:"#F8F9FA",strokeWidth:"6.5",strokeLinecap:"round"}),(0,s.jsx)("path",{d:"M39 28.5C47.4927 28.5 55.5 20.4927 55.5 12C55.5 3.50736 47.4927 -4.5 39 -4.5C30.5074 -4.5 22.5 3.50736 22.5 12C22.5 20.4927 30.5074 28.5 39 28.5Z",stroke:"#F8F9FA",strokeWidth:"5.5",strokeLinecap:"round"})]})}),(0,s.jsx)("div",{className:"mt-10 text-center",children:(0,s.jsx)("h3",{className:"font-bold text-gray-700 text-2xl",children:"Switch User"})}),(0,s.jsxs)("div",{className:"mt-16 text-center px-6",children:[(0,s.jsx)("p",{className:"text-gray-600 text-lg mb-8 leading-relaxed",children:"Are you sure you want to switch users? This will automatically log you out and stop your current shift timer."}),(0,s.jsxs)("div",{className:"flex space-x-6",children:[(0,s.jsx)("button",{onClick:()=>v(!1),className:"flex-1 bg-gray-200 text-gray-700 font-semibold py-3 rounded-xl hover:bg-gray-300 transition-colors",children:"Cancel"}),(0,s.jsx)("button",{onClick:eh,className:"flex-1 bg-[#1D4FB6] text-white font-semibold py-3 rounded-xl hover:bg-indigo-700 transition-colors",children:"Switch User"})]})]})]})})]})}},2317:function(e,t,r){"use strict";r.d(t,{db:function(){return c}});var s=r(5236),a=r(9842),o=r(9930),i=r.n(o),n=r(5735),l=r(9854);i().config();let d=(0,s.ZF)({apiKey:"AIzaSyAFTMCP8Xess7YdQORSVoL-NGFDjPCnMHM",authDomain:"omebudgetapp-9f89b.firebaseapp.com",projectId:"homebudgetapp-9f89b",storageBucket:"homebudgetapp-9f89b.appspot.com",messagingSenderId:"376870799077",appId:"1:376870799077:web:63ec29e676a073f02f760c"}),c=(0,a.ad)(d);(0,n.v0)(d),(0,l.cF)(d)},6395:function(e,t,r){"use strict";r.d(t,{i:function(){return s}});let s={Collected:"collected",Pending:"pending",Completed:"completed",Ironing:"ironing",Ready:"ready"}}}]);