(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[474],{6659:function(e,t,s){Promise.resolve().then(s.bind(s,2802))},2802:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return m}});var r=s(7437),l=s(2265),a=s(4837),n=s(8790),d=s(2317),i=s(9842),o=s(6395);let c=e=>{let{setShowMessage:t}=e,[s,a]=(0,l.useState)([]),[n,c]=(0,l.useState)(!0),[m,u]=(0,l.useState)("All"),[x,h]=(0,l.useState)("All"),[p,g]=(0,l.useState)(!1),[j,v]=(0,l.useState)(!1),[b,f]=(0,l.useState)(!1),[N,y]=(0,l.useState)(null),[w,k]=(0,l.useState)(""),[D,C]=(0,l.useState)(""),[A,S]=(0,l.useState)(null),[L,I]=(0,l.useState)(null),[O,M]=(0,l.useState)({highlightOrderRowRed:2}),[E,R]=(0,l.useState)([]),[z,T]=(0,l.useState)({orders:0,pieces:0,value:0,unpaid:0}),[_,B]=(0,l.useState)({notes:"",rackNumber:""});(0,l.useEffect)(()=>{let e=localStorage.getItem("userData");e&&S(JSON.parse(e).id);let t=localStorage.getItem("selectedStoreId");t&&I(t)},[]),(0,l.useEffect)(()=>{A&&L&&(P(),F())},[A,L]);let P=async()=>{try{let e=(0,i.JU)(d.db,"storeSettings",L),t=await getDoc(e);if(t.exists()){let e=t.data();M({highlightOrderRowRed:e.highlightOrderRowRed||2})}}catch(e){console.error("Error fetching store settings:",e)}};(0,l.useEffect)(()=>{if(!A||!L)return;let e=setInterval(()=>{F()},3e4);return()=>clearInterval(e)},[A,L]);let F=async()=>{try{c(!0);let e=(0,i.hJ)(d.db,"pos_orders",A,"stores",L,"orders"),t=(0,i.IO)(e,(0,i.ar)("status","==",o.i.Pending)),s=await (0,i.PL)(t),r=[];s.forEach(e=>{var t,s;let l=e.data();r.push({id:e.id,...l,createdAt:(null===(t=l.createdAt)||void 0===t?void 0:t.toDate())||new Date,deliveryDate:(null===(s=l.deliveryDate)||void 0===s?void 0:s.toDate())||new Date})}),a(r)}catch(e){console.error("Error fetching orders:",e),t({type:"error",message:"Failed to fetch orders"})}finally{c(!1)}},J=e=>{let t=e.selectedItems||e.orders||e.items||[];return Array.isArray(t)?t.reduce((e,t)=>e+(Number(null==t?void 0:t.quantity)||0),0):0},U=e=>{let t=e.section||e.category||e.serviceType||e.type;if(t)return t;let s=e.selectedItems||e.orders||e.items||[],r=Array.isArray(s)&&s.length>0?s[0]:null;return(null==r?void 0:r.section)||(null==r?void 0:r.category)||(null==r?void 0:r.type)||"Unknown"},H=(e,t)=>{if("All"===t)return!0;let s=new Date;s.setHours(0,0,0,0);let r=new Date(s);r.setHours(23,59,59,999);let l=e.deliveryDate instanceof Date?e.deliveryDate:new Date(e.deliveryDate),a=e.createdAt instanceof Date?e.createdAt:new Date(e.createdAt),n=l>=s&&l<=r,d=(()=>{let e=new Date(s);e.setDate(e.getDate()+1);let t=new Date(r);return t.setDate(t.getDate()+1),l>=e&&l<=t})(),i=l<s;switch(t){case"Due Today":return n;case"Due Tomorrow":return d;case"Due Today & Overdue":return n||i;case"Overdue":return i;case"Created Today":return a>=s&&a<=r;default:return!0}},V=e=>!!e.deliveryDate&&Math.floor((new Date-new Date(e.deliveryDate))/864e5)>=parseInt(O.highlightOrderRowRed);(0,l.useEffect)(()=>{let e=D.toLowerCase(),t=s.filter(t=>{var s,r,l;let a=(null===(r=t.customer)||void 0===r?void 0:null===(s=r.name)||void 0===s?void 0:s.toLowerCase())||"",n=(null===(l=t.orderId)||void 0===l?void 0:l.toLowerCase())||"",d=!e||a.includes(e)||n.includes(e),i=U(t),o="All"===m||i===m,c=H(t,x);return d&&o&&c});R(t);let r=t.length;T({orders:r,pieces:t.reduce((e,t)=>e+J(t),0),value:t.reduce((e,t)=>e+(Number(null==t?void 0:t.totalAmount)||Number(null==t?void 0:t.total)||0),0),unpaid:t.reduce((e,t)=>{let s=Number(null==t?void 0:t.totalAmount)||Number(null==t?void 0:t.total)||0,r=Number(null==t?void 0:t.paidAmount)||Number(null==t?void 0:t.paid)||0,l=Number(null==t?void 0:t.dueAmount);return e+(Number.isFinite(l)?l:Math.max(0,s-r))},0)})},[s,D,m,x]);let W=e=>{y(e),g(!0)},q=e=>{y(e),B({notes:e.notes||"",rackNumber:e.rackNumber||""}),f(!0)},K=e=>{y(e),v(!0)},Q=async()=>{if(N&&w)try{let e=(0,i.JU)(d.db,"pos_orders",A,"stores",L,"orders",N.orderId);await (0,i.r7)(e,{status:o.i.Ironing,rackNumber:w,updatedAt:new Date,cleanedDateTime:new Date}),await F(),t({type:"success",message:"Order marked as cleaned successfully"}),g(!1),k(""),y(null)}catch(e){console.error("Error updating order:",e),t({type:"error",message:"Failed to update order"})}},Z=async()=>{if(N)try{let e=(0,i.JU)(d.db,"pos_orders",A,"stores",L,"orders",N.orderId);await (0,i.r7)(e,{notes:_.notes,rackNumber:_.rackNumber,updatedAt:new Date}),await F(),t({type:"success",message:"Order updated successfully"}),f(!1),y(null)}catch(e){console.error("Error updating order:",e),t({type:"error",message:"Failed to update order"})}},G=async()=>{if(N)try{let e=(0,i.JU)(d.db,"pos_orders",A,"stores",L,"orders",N.orderId);await (0,i.oe)(e),await F(),t({type:"success",message:"Order deleted successfully"}),v(!1),y(null)}catch(e){console.error("Error deleting order:",e),t({type:"error",message:"Failed to delete order"})}},X=e=>null==e?void 0:e.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center mb-1",children:[(0,r.jsx)("span",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:e.color||"#000"}}),(0,r.jsxs)("span",{className:"text-sm",children:[e.name," \xd7 ",e.quantity]})]},t));return(0,r.jsxs)("div",{className:"flex-1 p-6 mt-20",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold mr-4",children:"Cleaning"}),(0,r.jsx)("div",{className:"hidden md:block w-px h-6 bg-gray-200 mx-2"}),(0,r.jsxs)("div",{className:"flex items-center gap-3 ml-4 md:ml-16 lg:ml-24",children:[(0,r.jsxs)("button",{className:"px-3 py-2 border rounded text-sm flex items-center gap-2 bg-white hover:bg-gray-50",onClick:()=>window.open("/Admin/Operational","_blank"),children:[(0,r.jsx)("span",{children:"Packing report"}),(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 9V2h12v7M6 18H5a2 2 0 01-2-2V9h18v7a2 2 0 01-2 2h-1M6 14h12v8H6v-8z"})})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("label",{className:"mr-2 text-sm text-gray-600",children:"Filter Section"}),(0,r.jsxs)("select",{value:m,onChange:e=>u(e.target.value),className:"px-3 py-2 border rounded bg-white text-sm",children:[(0,r.jsx)("option",{value:"All",children:"All"}),(0,r.jsx)("option",{value:"Dry Cleaning",children:"Dry Cleaning"}),(0,r.jsx)("option",{value:"Bulk Laundry",children:"Bulk Laundry"})]})]}),(0,r.jsxs)("select",{value:x,onChange:e=>h(e.target.value),className:"px-3 py-2 border rounded bg-white text-sm",children:[(0,r.jsx)("option",{children:"All"}),(0,r.jsx)("option",{children:"Due Today"}),(0,r.jsx)("option",{children:"Due Tomorrow"}),(0,r.jsx)("option",{children:"Due Today & Overdue"}),(0,r.jsx)("option",{children:"Overdue"}),(0,r.jsx)("option",{children:"Created Today"})]}),(0,r.jsx)("input",{type:"text",placeholder:"Search Order",value:D,onChange:e=>C(e.target.value),className:"px-3 py-2 border rounded text-sm w-48"})]})]}),(0,r.jsxs)("div",{className:"hidden md:flex items-center gap-6 text-xs text-gray-700",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"mr-1",children:"Orders"}),(0,r.jsx)("span",{className:"font-medium",children:z.orders})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"mr-1",children:"Pieces"}),(0,r.jsx)("span",{className:"font-medium",children:z.pieces})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"mr-1",children:"Value"}),(0,r.jsxs)("span",{className:"font-medium",children:["PKR ",z.value.toLocaleString()]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"mr-1",children:"Unpaid"}),(0,r.jsxs)("span",{className:"font-medium",children:["PKR ",z.unpaid.toLocaleString()]})]})]})]}),(0,r.jsx)("div",{className:"bg-white rounded-lg overflow-hidden",children:(0,r.jsxs)("table",{className:"w-full whitespace-nowrap",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b",children:[(0,r.jsx)("th",{className:"p-3 text-left text-xs font-medium text-gray-700",children:"Admin ID"}),(0,r.jsx)("th",{className:"p-3 text-left text-xs font-medium text-gray-700",children:"Placed"}),(0,r.jsx)("th",{className:"p-3 text-left text-xs font-medium text-gray-700",children:"Customer"}),(0,r.jsx)("th",{className:"p-3 text-left text-xs font-medium text-gray-700",children:"ORDER"}),(0,r.jsx)("th",{className:"p-3 text-left text-xs font-medium text-gray-700",children:"Qty"}),(0,r.jsx)("th",{className:"p-3 text-left text-xs font-medium text-gray-700",children:"Notes"}),(0,r.jsx)("th",{className:"p-3 text-left text-xs font-medium text-gray-700",children:"Rack #"}),(0,r.jsx)("th",{className:"p-3 text-right text-xs font-medium text-gray-700",children:"Actions"})]})}),(0,r.jsxs)("tbody",{className:"divide-y divide-gray-100",children:[E.map(e=>{var t;return(0,r.jsxs)("tr",{className:"hover:bg-gray-50 ".concat(V(e)?"bg-red-50":""),children:[(0,r.jsx)("td",{className:"p-3 text-sm",children:e.adminId||"-"}),(0,r.jsx)("td",{className:"p-3 text-sm",children:e.createdAt.toLocaleDateString()}),(0,r.jsx)("td",{className:"p-3 text-sm",children:(null===(t=e.customer)||void 0===t?void 0:t.name)||"-"}),(0,r.jsx)("td",{className:"p-3 text-sm",children:(0,r.jsx)("div",{className:"max-w-xs",children:X(e.selectedItems||e.orders||e.items)})}),(0,r.jsx)("td",{className:"p-3 text-sm",children:J(e)}),(0,r.jsx)("td",{className:"p-3 text-sm",children:e.notes||"-"}),(0,r.jsx)("td",{className:"p-3 text-sm",children:e.rackNumber||"-"}),(0,r.jsx)("td",{className:"p-3 text-right",children:(0,r.jsxs)("div",{className:"flex justify-end items-center gap-4",children:[(0,r.jsx)("button",{onClick:()=>K(e),className:"text-red-500 hover:text-red-600",title:"Delete",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),(0,r.jsx)("button",{onClick:()=>q(e),className:"text-indigo-600 hover:text-indigo-700",title:"Edit",children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16.862 3.487a2.1 2.1 0 012.971 2.971L9.75 16.54 6 17.5l.96-3.75L16.862 3.487z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 21h9"})]})}),(0,r.jsx)("button",{onClick:()=>W(e),className:"px-4 py-2 bg-indigo-50 text-indigo-700 rounded-full text-sm hover:bg-indigo-100",children:(0,r.jsx)("span",{className:"whitespace-nowrap",children:"Mark as Cleaned"})})]})})]},e.orderId)}),n&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{className:"p-3 text-sm",colSpan:"8",children:"Loading orders..."})})]})]})}),p&&N&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,r.jsxs)("div",{className:"relative bg-white p-6 rounded-xl w-[380px] shadow-xl",children:[(0,r.jsx)("button",{onClick:()=>{g(!1),y(null)},className:"absolute right-4 top-4 text-gray-500 hover:text-gray-700","aria-label":"Close",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,r.jsx)("h2",{className:"mb-6 text-2xl font-semibold text-center",children:"Mark as Cleaned"}),(0,r.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,r.jsx)("label",{className:"text-base font-medium",children:"Order#"}),(0,r.jsxs)("div",{className:"text-gray-600",children:["#",N.orderId||""]})]}),(0,r.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,r.jsx)("label",{className:"text-base font-medium mr-4",children:"Rack #"}),(0,r.jsx)("input",{type:"text",value:w,onChange:e=>k(e.target.value),placeholder:"#",className:"px-3 py-2 border border-indigo-300 rounded-md text-sm w-40 focus:outline-none focus:ring-2 focus:ring-indigo-200"})]}),(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)("button",{onClick:Q,className:"px-4 py-2 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700",children:"Move to Ironing"})})]})}),b&&N&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg w-96",children:[(0,r.jsx)("h2",{className:"mb-4 text-lg font-semibold",children:"Edit Order"}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block mb-1 text-sm font-medium",children:"Order #"}),(0,r.jsx)("input",{type:"text",value:N.orderId||"",disabled:!0,className:"w-full px-3 py-2 border rounded bg-gray-50 text-sm"})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block mb-1 text-sm font-medium",children:"Notes"}),(0,r.jsx)("textarea",{value:_.notes,onChange:e=>B({..._,notes:e.target.value}),className:"w-full px-3 py-2 border rounded text-sm",rows:"3"})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block mb-1 text-sm font-medium",children:"Rack #"}),(0,r.jsx)("input",{type:"text",value:_.rackNumber,onChange:e=>B({..._,rackNumber:e.target.value}),className:"w-full px-3 py-2 border rounded text-sm"})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,r.jsx)("button",{onClick:()=>{f(!1),y(null)},className:"px-4 py-2 border rounded text-sm",children:"Cancel"}),(0,r.jsx)("button",{onClick:Z,className:"px-4 py-2 bg-blue-600 text-white rounded text-sm",children:"Save Changes"})]})]})}),j&&N&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,r.jsxs)("div",{className:"bg-white p-6 rounded-lg w-96",children:[(0,r.jsx)("h2",{className:"mb-4 text-lg font-semibold",children:"Delete Order"}),(0,r.jsx)("p",{className:"mb-6 text-sm",children:"Are you sure you want to delete this order? This action cannot be undone."}),(0,r.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,r.jsx)("button",{onClick:()=>{v(!1),y(null)},className:"px-4 py-2 border rounded text-sm",children:"Cancel"}),(0,r.jsx)("button",{onClick:G,className:"px-4 py-2 bg-red-600 text-white rounded text-sm",children:"Delete"})]})]})})]})};function m(){let[e,t]=(0,l.useState)({type:null,message:null});return(0,l.useEffect)(()=>{let e=setTimeout(()=>{t({type:null,message:null})},3e3);return()=>clearTimeout(e)},[e.message]),(0,r.jsxs)(r.Fragment,{children:[e.message&&("success"===e.type?(0,r.jsx)(n.kk,{message:e.message}):(0,r.jsx)(n.Bc,{message:e.message})),(0,r.jsxs)("div",{className:"min-h-screen",children:[(0,r.jsx)(a.Z,{}),(0,r.jsx)(c,{setShowMessage:t})]})]})}},8790:function(e,t,s){"use strict";s.d(t,{Bc:function(){return a},kk:function(){return l}});var r=s(7437);s(2265);let l=e=>{let{message:t}=e;return(0,r.jsxs)("div",{style:{zIndex:"999"},className:"fixed top-16 left-1/2 transform -translate-x-1/2 -translate-y-1/2  bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded flex items-center",role:"alert",children:[(0,r.jsx)("svg",{className:"fill-current h-6 w-6 text-green-500 mr-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{d:"M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM6.7 9.29L9 11.6l4.3-4.3 1.4 1.42L9 14.4l-3.7-3.7 1.4-1.42z"})}),(0,r.jsx)("span",{className:"block sm:inline",children:t})]})},a=e=>{let{message:t}=e;return(0,r.jsxs)("div",{style:{zIndex:"999"},className:"fixed top-16 left-1/2 transform -translate-x-1/2 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded flex items-center",role:"alert",children:[(0,r.jsx)("svg",{className:"fill-current h-6 w-6 text-red-500 mr-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{d:"M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0zm-7 4a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-1-9a1 1 0 0 0-1 1v4a1 1 0 1 0 2 0V6a1 1 0 0 0-1-1z"})}),(0,r.jsx)("span",{className:"block sm:inline",children:t})]})}}},function(e){e.O(0,[358,657,218,699,109,853,163,971,23,744],function(){return e(e.s=6659)}),_N_E=e.O()}]);