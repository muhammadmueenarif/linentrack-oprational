(()=>{var e={};e.id=484,e.ids=[484],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6113:e=>{"use strict";e.exports=require("crypto")},9523:e=>{"use strict";e.exports=require("dns")},2361:e=>{"use strict";e.exports=require("events")},358:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5158:e=>{"use strict";e.exports=require("http2")},1808:e=>{"use strict";e.exports=require("net")},2037:e=>{"use strict";e.exports=require("os")},1017:e=>{"use strict";e.exports=require("path")},7282:e=>{"use strict";e.exports=require("process")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},5536:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>f,tree:()=>d}),r(6728),r(7764),r(5866);var o=r(3191),s=r(8716),a=r(7922),i=r.n(a),n=r(5231),l={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);r.d(t,l);let d=["",{children:["Login",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,6728)),"/Users/usman/Linentrack/linentrack-oprational/app/Login/page.js"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,7481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,7764)),"/Users/usman/Linentrack/linentrack-oprational/app/layout.js"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,7481))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["/Users/usman/Linentrack/linentrack-oprational/app/Login/page.js"],u="/Login/page",m={require:r,loadChunk:()=>Promise.resolve()},f=new o.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/Login/page",pathname:"/Login",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},4808:(e,t,r)=>{Promise.resolve().then(r.bind(r,5604))},5604:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c,dynamic:()=>d});var o=r(326),s=r(7577),a=r(5047),i=r(9394),n=r(7147),l=r(76);let d="force-dynamic",c=()=>{let e=(0,a.useRouter)(),[t,r]=(0,s.useState)({email:"",password:""}),[d,c]=(0,s.useState)(!1),[u,m]=(0,s.useState)("Admin"),[f,p]=(0,s.useState)(null);(0,s.useEffect)(()=>{let t=localStorage.getItem("token"),r=localStorage.getItem("userData"),o=localStorage.getItem("selectedStoreId");if(t&&r&&o)try{let t=JSON.parse(r);"Staff"===t.roleType&&("operations"===t.accessMode||"operation"===t.accessMode)?e.push("/"):e.push("/Login")}catch(t){console.error("Error parsing userData on redirect:",t),e.push("/Login")}},[e]);let g=e=>{r({...t,[e.target.name]:e.target.value})},h=async(e,t,r,o)=>{try{let s="unknown";try{let e=await fetch("https://api.ipify.org?format=json");e.ok?s=(await e.json()).ip:console.warn("Failed to fetch IP from ipify API.")}catch(e){console.error("Error fetching IP from ipify:",e)}let a=navigator.userAgent||"unknown";await (0,l.ET)((0,l.hJ)(n.db,"user_logins"),{userId:e||"unknown_user",userType:t||"unknown",storeId:r||"unknown",storeName:o||"unknown",ip:s,timestamp:l.EK.now(),userAgent:a})}catch(e){console.error("Failed to track login:",e)}},w=async e=>{try{if(!e||"unknown"===e)return!1;let t=(0,l.hJ)(n.db,"blockip"),r=(0,l.IO)(t,(0,l.ar)("ip","==",e));return!(await (0,l.PL)(r)).empty}catch(e){return console.error("Error checking blocked IP:",e),!1}},b=async r=>{r.preventDefault(),c(!0),localStorage.removeItem("selectedStoreId"),localStorage.removeItem("selectedStore"),localStorage.removeItem("token"),localStorage.removeItem("userData");let o=null,s=null,a="",d="",m="",f=null,p=null,g=!1;try{let r="unknown";try{let e=await fetch("https://api.ipify.org?format=json");if(e.ok&&(r=(await e.json()).ip,await w(r)))throw Error("Access denied: Your IP address has been blocked by an administrator. Please contact support for assistance.")}catch(e){if(e.message.includes("Access denied: Your IP address has been blocked"))throw e;console.error("Error fetching IP or checking block status:",e)}if(!t.email||!t.password)throw Error("Please provide email and password");let c=t.email.trim(),b=c.toLowerCase(),x=t.password;if(console.info("[Login] Attempt start",{loginType:u,email:b,rawEmailDifferent:c!==b}),"Admin"===u){a="clients",m="Admin";{let e=(0,l.hJ)(n.db,a),t=await (0,l.PL)((0,l.IO)(e,(0,l.ar)("email","==",b)));t.empty&&(console.debug("[Login] clients lookup with lowercased email returned empty. Trying raw email"),t=await (0,l.PL)((0,l.IO)(e,(0,l.ar)("email","==",c)))),t.empty||(s=(o=t.docs[0]).data(),console.info("[Login] Found Admin in clients",{userId:o.id,email:s?.email}))}if(!o){let e=(0,l.hJ)(n.db,"storeStaff"),t=await (0,l.PL)((0,l.IO)(e,(0,l.ar)("email","==",b)));if(t.empty&&(console.debug("[Login] storeStaff lookup with lowercased email returned empty. Trying raw email"),t=await (0,l.PL)((0,l.IO)(e,(0,l.ar)("email","==",c)))),t.empty)console.warn("[Login] No records found in clients or storeStaff for provided email");else{let e=t.docs.find(e=>"admin"===(e.data()?.accessMode||"").toLowerCase());e?(o=e,s=e.data(),a="storeStaff",m="Staff",g=!0,console.info("[Login] Using fallback Admin from storeStaff",{userId:o.id,email:s?.email,accessMode:s?.accessMode,storeId:s?.storeId})):console.warn("[Login] storeStaff records found for email, but none with accessMode Admin")}}if(!o)throw Error(`Invalid credentials or user not found for ${u} role.`)}else if("POS"===u||"Operations"===u){a="storeStaff",m="Staff";let e=(0,l.hJ)(n.db,a),t=(0,l.IO)(e,(0,l.ar)("email","==",b)),r=await (0,l.PL)(t);if(r.empty)throw Error(`Invalid credentials or user not found for ${u} role.`);s=(o=r.docs[0]).data(),console.info("[Login] Found Staff for POS/Operations",{userId:o.id,email:s?.email,accessMode:s?.accessMode,storeId:s?.storeId})}else throw Error("Invalid login type selected");let y=async()=>{let e=null!=s.password?String(s.password):"";if(e===x)return console.debug("[Login] Password verified"),!0;if(console.warn("[Login] Password mismatch",{userId:o.id,collectionName:a,hasStoredPassword:!!s.password,storedPasswordLength:e.length,inputPasswordLength:x.length}),"Admin"===u&&"clients"===a)try{let e=(0,l.hJ)(n.db,"storeStaff"),t=await (0,l.PL)((0,l.IO)(e,(0,l.ar)("email","==",b)));if(t.empty&&(t=await (0,l.PL)((0,l.IO)(e,(0,l.ar)("email","==",c)))),t.empty)console.warn("[Login] No storeStaff records for email during fallback");else{let e=t.docs.find(e=>"admin"===(e.data()?.accessMode||"").toLowerCase());if(e){let t=e.data();if((null!=t.password?String(t.password):"")===x)return o=e,s=t,a="storeStaff",m="Staff",g=!0,console.info("[Login] Falling back to storeStaff Admin with matching password",{userId:o.id,email:s?.email,accessMode:s?.accessMode}),!0;console.warn("[Login] Fallback storeStaff Admin password mismatch")}else console.warn("[Login] Fallback storeStaff Admin not found for email")}}catch(e){console.error("[Login] Error during fallback staff admin lookup",e)}return!1};if(!await y())throw Error(`Invalid credentials for ${u} role.`);if("Staff"===m){let e="Admin"===u?"admin":u.toLowerCase(),t=s.accessMode?.toLowerCase();if(!t||t!==e)throw console.warn("[Login] Access mode check failed",{requiredAccessMode:e,userAccessMode:t,loginType:u,usedFallbackStaffAdmin:g}),Error(`Login failed: You do not have permission to access the ${u} portal.`);if("admin"===e)d="/Admin";else if("pos"===e)d="/Pos";else if("operations"===e)d="/Admin/Operational";else throw Error("Configuration error: Invalid redirect path for staff.")}else d="/Admin";if(console.info("[Login] Role resolved",{roleType:m,redirectPath:d,usedFallbackStaffAdmin:g}),"Admin"===m){let e=(0,l.IO)((0,l.hJ)(n.db,"stores"),(0,l.ar)("adminId","==",o.id),(0,l.b9)(1)),t=await (0,l.PL)(e);if(t.empty)throw Error("Login failed: No stores are currently associated with this admin account.");let r=t.docs[0];f=r.id,p=r.data(),console.debug("[Login] Admin store selected",{selectedStoreId:f,storeName:p?.storeName})}else{let e=s.storeId;if(!e)throw Error("Login failed: Store assignment is missing for this staff account.");let t=(0,l.JU)(n.db,"stores",e),r=await (0,l.QT)(t);if(!r.exists())throw Error(`Login failed: Assigned store (ID: ${e}) not found. Please contact support.`);f=r.id,p=r.data(),console.debug("[Login] Staff store resolved",{selectedStoreId:f,storeName:p?.storeName})}if(!f||!p)throw Error("Login failed: Could not retrieve store details.");if(console.info("[Login] Store details ready",{selectedStoreId:f,storeName:p?.storeName}),"clients"===a&&"Demo"===s.userType&&s.createdDate){let e=s.createdDate.toDate?s.createdDate.toDate():new Date(s.createdDate),t=parseInt(s.days)||0,r=new Date,o=new Date(e);if(o.setDate(o.getDate()+t),r>o)throw Error("Your demo account has expired. Please contact support.")}let S=`insecure-dev-token-${o.id}-${Date.now()}`,I={id:o.id,email:s.email,name:s.name,roleType:m,selectedStoreId:f,selectedStoreName:p.storeName,..."Admin"===m&&{userType:s.userType,companyName:s.companyName},..."Staff"===m&&{accessMode:s.accessMode,ownerAdminId:s.userId}};localStorage.setItem("token",S);try{Object.keys(localStorage).forEach(e=>{e.startsWith("userPermissions:")&&localStorage.removeItem(e)})}catch{}if(localStorage.setItem("userData",JSON.stringify(I)),localStorage.setItem("selectedStoreId",f),localStorage.setItem("selectedStoredata",JSON.stringify({id:f,...p})),localStorage.setItem("selectedStore",p.storeName),await h(o.id,u,f,p.storeName),"Staff"===m)try{let e=new Date().toLocaleDateString("en-GB"),t=new Date,r=t.getHours(),a=6,i=22;try{let e=(0,l.JU)(n.db,"storeSettings",f),t=await (0,l.QT)(e);if(t.exists()){let e=t.data();a=e?.security?.clockInSettings?.shiftStartHour??6,i=e?.security?.clockInSettings?.shiftEndHour??22}}catch(e){console.warn("[Login] Could not fetch shift hours settings",e)}if(r>=a&&r<i){let r=(0,l.hJ)(n.db,"staffShifts"),a=(0,l.IO)(r,(0,l.ar)("storeId","==",f),(0,l.ar)("userId","==",o.id),(0,l.ar)("date","==",e),orderBy("createdAt","desc"),(0,l.b9)(1)),i=await (0,l.PL)(a);if(i.empty||i.docs[0].data().clockOut&&""!==i.docs[0].data().clockOut){let a=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),i={storeId:f,storeName:p.storeName,userId:o.id,name:s.name||s.email||"Staff",date:e,clockIn:a,clockOut:"",clockInISO:t.toISOString(),clockOutISO:"",createdAt:l.EK.now()};await (0,l.ET)(r,i),await (0,l.ET)((0,l.hJ)(n.db,"shifts"),i),console.info("[Login] Auto clock-in created for staff",{userId:o.id,time:a})}}else console.info("[Login] Auto clock-in skipped - outside shift hours",{currentHour:r,shiftStartHour:a,shiftEndHour:i,userId:o.id})}catch(e){console.warn("[Login] Auto clock-in failed",e)}i.Am.success(`Logged in successfully as ${u} for store: ${p.storeName}! Redirecting...`),e.push(d)}catch(t){console.error("Login error:",t),localStorage.removeItem("selectedStoreId"),localStorage.removeItem("selectedStore"),localStorage.removeItem("selectedStoredata"),localStorage.removeItem("token"),localStorage.removeItem("userData");let e=t.message.includes("Access denied: Your IP address has been blocked")?t.message:t.message.includes("credentials")||t.message.includes("not found for")?`Invalid credentials or user not found for ${u}.`:t.message.includes("permission")||t.message.includes("No stores")||t.message.includes("Store assignment is missing")||t.message.includes("store (ID:")||t.message.includes("Could not retrieve store details")?t.message:t.message.includes("expired")?t.message:`Login failed for ${u}. Please try again.`;i.Am.error(e)}finally{c(!1)}};return(0,o.jsxs)("div",{className:"min-h-screen flex flex-col md:flex-row ",children:[o.jsx("div",{style:{backgroundImage:"url('/Login/loginleftSide.png')",backgroundSize:"cover",backgroundPosition:"center"},className:"hidden md:flex md:w-1/2 bg-blue-700 p-12 lg:p-16 flex-col justify-center relative overflow-hidden"}),o.jsx("div",{className:"w-full md:w-1/2 flex items-center justify-center p-6 md:p-12 bg-gray-50",children:(0,o.jsxs)("div",{className:"w-full max-w-md bg-white p-8 lg:p-10 rounded-lg shadow-xl space-y-6",children:[o.jsx("h2",{className:"text-2xl font-semibold text-gray-800 text-center",children:"Login with your credentials"}),o.jsx("div",{className:"flex space-x-2 border-b border-gray-200 pb-3 justify-center",children:["Admin","POS","Operations"].map(e=>o.jsx("button",{type:"button",onClick:()=>m(e),disabled:d,className:`px-5 py-2 text-sm font-medium rounded-full transition-all duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-400 ${u===e?"bg-blue-600 text-white shadow-md scale-105":"text-gray-600 hover:bg-gray-100 border border-gray-300 hover:text-gray-800"} ${d?"cursor-not-allowed opacity-70":""}`,children:e},e))}),(0,o.jsxs)("form",{onSubmit:b,className:"space-y-5 pt-2",children:[(0,o.jsxs)("div",{className:"relative",children:[o.jsx("input",{id:"email",name:"email",type:"email",required:!0,autoComplete:"email",className:`block w-full px-3 pt-6 pb-2 border-2 rounded-md shadow-sm transition-all duration-200 ease-in-out sm:text-sm disabled:bg-gray-100 disabled:cursor-not-allowed ${t.email||"email"===f?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"} focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500`,placeholder:" ",value:t.email,onChange:g,onFocus:()=>p("email"),onBlur:()=>p(null),disabled:d}),o.jsx("label",{htmlFor:"email",className:`absolute left-3 transition-all duration-200 ease-in-out pointer-events-none ${t.email||"email"===f?"-top-2 bg-white px-1 text-xs text-blue-600 font-medium":"top-3 text-sm text-gray-500"}`,children:"Email"})]}),(0,o.jsxs)("div",{className:"relative",children:[o.jsx("input",{id:"password",name:"password",type:"password",required:!0,autoComplete:"current-password",className:`block w-full px-3 pt-6 pb-2 border-2 rounded-md shadow-sm transition-all duration-200 ease-in-out sm:text-sm disabled:bg-gray-100 disabled:cursor-not-allowed ${t.password||"password"===f?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"} focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500`,placeholder:" ",value:t.password,onChange:g,onFocus:()=>p("password"),onBlur:()=>p(null),disabled:d}),o.jsx("label",{htmlFor:"password",className:`absolute left-3 transition-all duration-200 ease-in-out pointer-events-none ${t.password||"password"===f?"-top-2 bg-white px-1 text-xs text-blue-600 font-medium":"top-3 text-sm text-gray-500"}`,children:"Password"})]}),o.jsx("div",{className:"text-right",children:o.jsx("a",{href:"#",className:`text-sm font-medium text-blue-600 hover:text-blue-500 ${d?"pointer-events-none opacity-70":""}`,children:"Forgot Password?"})}),o.jsx("button",{type:"submit",disabled:d,className:"w-full flex justify-center py-2.5 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-60 disabled:cursor-not-allowed transition-colors duration-200",children:d?(0,o.jsxs)("div",{className:"flex items-center justify-center",children:[(0,o.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Signing In..."]}):`Sign In as ${u}`})]})]})})]})}},6728:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>i,__esModule:()=>a,default:()=>l,dynamic:()=>n});var o=r(8570);let s=(0,o.createProxy)(String.raw`/Users/usman/Linentrack/linentrack-oprational/app/Login/page.js`),{__esModule:a,$$typeof:i}=s;s.default;let n=(0,o.createProxy)(String.raw`/Users/usman/Linentrack/linentrack-oprational/app/Login/page.js#dynamic`),l=(0,o.createProxy)(String.raw`/Users/usman/Linentrack/linentrack-oprational/app/Login/page.js#default`)},7481:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var o=r(6621);let s=e=>[{type:"image/x-icon",sizes:"16x16",url:(0,o.fillMetadataSegment)(".",e.params,"favicon.ico")+""}]}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[948,1,621,578],()=>r(5536));module.exports=o})();